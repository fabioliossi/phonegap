<!DOCTYPE html>
<html lang="en">
<head>

  <script type="text/javascript" src="cordova.js"></script>
  <script src="jquery-1.11.3.js"></script>

  <script type="text/javascript" src="bootstrap.min.js"></script>

  <link rel="stylesheet" type="text/css" href="bootstrap.min.css">

  <meta charset="UTF-8">
  <!-- meta http-equiv="Content-Security-Policy" content="img-src *; default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'" /-->
  <title>Venda +</title>

</head>
<body style="color:#0B2161 !important">

  <table  width="100%" style="background-color: #0B2161">
    <tr>
      <td style="padding:3px; color:white">
        <h5> <b> Minhas Vendas</b></h5>
      </td>
      <td style="padding:3px; color:white">
        <button type="button" onclick="voltarDashboard()" class="btn btn-primary btn-xs" style="float:right">Voltar</button>
      </td>
    </tr>
  </table>

  <div class="container">


    <div class="table-responsive">
    <div class="col-md-12" id="div_product_list">

      </div>
    </div>

  </div>
</body>






<script type="text/javascript">



// window.openDatabase("database-name","version","database description","database size in bytes")
var db = window.openDatabase("tutorialdb", "1.0", "tutorial database", 1000000); //will create database Dummy_DB or open it
document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady() {

  document.addEventListener("backbutton", voltarDashboard, false);

  mostraProdutos();

}

function mostraProdutos()
{
  db.transaction(function(tx){

    tx.executeSql("select v.id, v.data_finalizacao as data, count(distinct vp.product_id) as produtos, sum(vp.qtd) as qtd, sum(vp.qtd*p.representative_price) as total from venda v join venda_produto vp on vp.venda_id = v.id join  product p on p.product_id = vp.product_id WHERE v.finalizada = 'S' AND vp.ativo='1' group by 1,2",[],function(tx1,result){
      var len = result.rows.length;

      console.log(result);


      var $table = '<table style="font-size:8pt" class="table"><thead>';
      $table +='<tr><th scope="col">CÃ³digo</th><th scope="col">Data</th><th scope="col">Produtos</th><th scope="col">Qtd.</th><th scope="col">Valor Total</th></tr></thead>';


      for (var i=0; i<len; i++){
        var product = result.rows.item(i);

        $table += '<tr><td>'+product.id+'</td>';
          $table += '<td>'+product.data+'</td>';
        $table += '<td>'+product.produtos+'</td>';
        $table += '<td>'+product.qtd+'</td>';
        $table += '<td>'+product.total.toFixed(2)+'</td></tr>';

      }

      $("#div_product_list").html($table);

    });
  });

}

function voltarDashboard()
{
  window.location.replace('./dashboard.html');
}




</script>



</html>
